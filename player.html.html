<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ultra Minimal Video — Android UI (Playlist + MP4/HLS/DASH/Embed)</title>
<style>
  :root { --bg:#0b0f14; --surface:#121a23; --surface-2:#0f141a; --text:#e6edf3; --muted:#9fb0c0; --primary:#5eead4; --accent:#7dd3fc; --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.35); }
  [data-theme="light"]{ --bg:#f7fafc; --surface:#ffffff; --surface-2:#f1f5f9; --text:#0b0f14; --muted:#506272; --primary:#0ea5e9; --accent:#22d3ee; --shadow:0 10px 30px rgba(2,6,23,.08); }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{ margin:0; background:var(--bg); color:var(--text); font:15px/1.5 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica Neue,Arial; letter-spacing:.2px; }
  .app{ max-width:1024px; margin:0 auto; padding:16px 16px 90px; display:grid; gap:16px; }
  header{ position:sticky; top:0; z-index:5; background:linear-gradient(180deg,var(--bg) 70%,transparent); padding-top:8px; }
  .topbar{ display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:12px; padding:8px 0 0; }
  .brand{ display:flex; gap:10px; align-items:center; font-weight:700; letter-spacing:.4px; }
  .logo{ width:34px; height:34px; border-radius:12px; background:linear-gradient(135deg,var(--accent),var(--primary)); box-shadow:var(--shadow); }
  .search{ display:flex; align-items:center; gap:8px; padding:10px 12px; border-radius:14px; background:var(--surface); border:1px solid rgba(255,255,255,.06); }
  .search input{ width:100%; background:transparent; border:0; color:var(--text); outline:none; font-size:14px }
  .icon-btn{ height:44px; width:44px; border-radius:14px; border:1px solid rgba(255,255,255,.06); background:var(--surface); display:grid; place-items:center; box-shadow:var(--shadow); }

  /* Player */
  .player-card{ background:var(--surface); border-radius:var(--radius); border:1px solid rgba(255,255,255,.06); box-shadow:var(--shadow); overflow:hidden; }
  .player-wrap{ position:relative; aspect-ratio:16/9; background:var(--surface-2); }
  video, iframe.embed{ width:100%; height:100%; display:block; background:#000; border:0; }
  .chipbar{ display:flex; gap:8px; padding:10px; flex-wrap:wrap; align-items:center; border-top:1px solid rgba(255,255,255,.06); background:linear-gradient(180deg,var(--surface),var(--surface-2)); }
  .chip{ padding:8px 12px; border-radius:999px; background:var(--surface-2); border:1px solid rgba(255,255,255,.06); color:var(--muted); font-size:12px }
  .actions{ margin-left:auto; display:flex; gap:8px }
  .btn{ padding:10px 14px; border-radius:12px; background:var(--accent); color:#021018; font-weight:700; border:0; box-shadow:var(--shadow); cursor:pointer }
  .btn.ghost{ background:var(--surface-2); color:var(--text); border:1px solid rgba(255,255,255,.06); font-weight:600 }

  /* Playlist loader */
  .loader{ display:flex; gap:8px; flex-wrap:wrap; align-items:center }
  .loader input[type="url"]{ flex:1 1 260px; min-width:200px; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.06); background:var(--surface-2); color:var(--text); }
  .file{ position:relative; overflow:hidden }
  .file input{ position:absolute; inset:0; opacity:0; cursor:pointer }
  .hint{ font-size:12px; color:var(--muted) }

  /* Grid */
  .section-title{ display:flex; justify-content:space-between; align-items:center; padding:6px 2px; color:var(--muted) }
  .grid{ display:grid; grid-template-columns:repeat(2,1fr); gap:12px }
  @media(min-width:640px){ .grid{ grid-template-columns:repeat(3,1fr) } }
  @media(min-width:900px){ .grid{ grid-template-columns:repeat(5,1fr) } }
  .card{ background:var(--surface); border:1px solid rgba(255,255,255,.06); border-radius:16px; overflow:hidden; cursor:pointer; transition:transform .15s ease, box-shadow .15s ease; }
  .thumb{ position:relative; aspect-ratio:16/9; overflow:hidden; background:var(--surface-2) }
  .thumb img{ width:100%; height:100%; object-fit:cover; display:block; filter:saturate(1.05) }
  .pill{ position:absolute; bottom:8px; right:8px; background:rgba(0,0,0,.6); color:#fff; font-size:12px; padding:4px 8px; border-radius:999px }
  .meta{ padding:10px }
  .title{ font-size:14px; font-weight:700; line-height:1.25; max-height:2.5em; overflow:hidden }
  .sub{ font-size:12px; color:var(--muted); margin-top:4px }
  .card:active{ transform:scale(.98) }
  .card:hover{ box-shadow:var(--shadow) }

  /* Bottom Nav */
  .nav{ position:fixed; left:0; right:0; bottom:0; z-index:10; display:grid; grid-template-columns:repeat(3,1fr); background:var(--surface); border-top:1px solid rgba(255,255,255,.06); }
  .nav a{ padding:10px 6px; text-align:center; color:var(--muted); text-decoration:none; font-size:12px }
  .nav svg{ display:block; margin:6px auto 2px; opacity:.9 }
  .nav a.active{ color:var(--text) }
  .sr-only{ position:absolute; left:-9999px }
</style>
<!-- HLS & DASH libs (CDN). Bisa dihapus jika tidak perlu HLS/DASH) -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/dashjs@4"></script>
</head>
<body>
  <div class="app" id="app">
    <header>
      <div class="topbar">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <div style="font-size:16px">Ultra Minimal Video</div>
            <div style="font-size:12px; color:var(--muted)">Android-style • Ultra UI</div>
          </div>
        </div>
        <label class="search" for="q">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
          <input id="q" placeholder="Cari video…" autocomplete="off" />
        </label>
        <button id="btnTheme" class="icon-btn" title="Tema">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 3v2m0 14v2M4.93 4.93l1.41 1.41m11.32 11.32 1.41 1.41M3 12h2m14 0h2M6.34 17.66l1.41-1.41m8.49-8.49 1.41-1.41M16 12a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
        </button>
      </div>
      <div class="loader" style="margin:10px 0 2px">
        <input id="playlistUrl" type="url" placeholder="URL playlist .m3u / .json"/>
        <button class="btn" id="btnLoad">Muat</button>
        <label class="btn ghost file">Pilih File<input id="filePick" type="file" accept=".m3u,.m3u8,.json"/></label>
        <span class="hint">Dukung: MP4, M3U8 (HLS), MPD (DASH), atau Embed (iframe)</span>
      </div>
    </header>

    <!-- PLAYER CARD -->
    <section class="player-card">
      <div class="player-wrap" id="playerWrap">
        <video id="player" controls playsinline preload="metadata" poster="" controlslist="nodownload noplaybackrate">
          <source id="playerSrc" src="" type="video/mp4" />
          Browser Anda tidak mendukung video HTML5.
        </video>
      </div>
      <div class="chipbar">
        <span id="nowTitle" class="chip">Pilih video untuk diputar</span>
        <div class="actions">
          <button class="btn ghost" id="btnPip" title="Picture-in-Picture">PiP</button>
          <button class="btn" id="btnOpen">Buka</button>
        </div>
      </div>
    </section>

    <!-- GRID LIST -->
    <div class="section-title">
      <strong>Semua Video</strong>
      <small id="countTxt">0 item</small>
    </div>
    <section id="grid" class="grid" aria-live="polite"></section>
  </div>

  <!-- Bottom Navigation (mock Android) -->
  <nav class="nav" role="navigation" aria-label="Bottom">
    <a class="active" href="#home" aria-current="page">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 10.5 12 3l9 7.5V21a1 1 0 0 1-1 1h-5v-6H9v6H4a1 1 0 0 1-1-1v-10.5Z" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/></svg>
      Beranda
    </a>
    <a href="#explore">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="m14.5 14.5-9 4 4-9 9-4-4 9Z" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/></svg>
      Jelajah
    </a>
    <a href="#profile">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-5.523 0-10 2.239-10 5v1h20v-1c0-2.761-4.477-5-10-5Z" stroke="currentColor" stroke-width="1.6"/></svg>
      Profil
    </a>
  </nav>

<script>
// ====== Helpers ======
const $ = s => document.querySelector(s);
const grid = $('#grid');
const player = $('#player');
const playerSrc = $('#playerSrc');
const playerWrap = $('#playerWrap');
const nowTitle = $('#nowTitle');
const countTxt = $('#countTxt');
const btnOpen = $('#btnOpen');
const btnPip = $('#btnPip');
const inputQ = $('#q');
const btnTheme = $('#btnTheme');
const playlistUrl = $('#playlistUrl');
const btnLoad = $('#btnLoad');
const filePick = $('#filePick');

let listData = [];
let hls = null;          // hls.js instance
let dash = null;         // dash.js instance
let currentType = 'mp4'; // mp4 | hls | dash | embed

// Theme persist
const savedTheme = localStorage.getItem('ui-theme');
if(savedTheme){ document.documentElement.setAttribute('data-theme', savedTheme); }
btnTheme.addEventListener('click', ()=>{ const cur = document.documentElement.getAttribute('data-theme') === 'light' ? 'dark' : 'light'; document.documentElement.setAttribute('data-theme', cur); localStorage.setItem('ui-theme', cur); });

// ====== Default list (fallback) ======
const defaults = [
  {title:"Big Buck Bunny — MP4", src:"https://archive.org/download/BigBuckBunny_328/BigBuckBunny_512kb.mp4", thumb:"https://picsum.photos/seed/mp4/640/360"},
  {title:"Elephants Dream — MP4", src:"https://archive.org/download/ElephantsDream/ed_1024_512kb.mp4", thumb:"https://picsum.photos/seed/mp42/640/360"},
  {title:"Tears of Steel — HLS", src:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8", thumb:"https://picsum.photos/seed/hls/640/360"},
  {title:"Envivio — DASH", src:"https://dash.akamaized.net/envivio/EnvivioDash3/manifest.mpd", thumb:"https://picsum.photos/seed/dash/640/360"},
  {title:"W3C Embed (iframe)", src:"https://www.youtube.com/embed/aqz-KE-bpKQ", type:"embed", thumb:"https://img.youtube.com/vi/aqz-KE-bpKQ/hqdefault.jpg"}
];

// ====== Render Grid ======
function render(list){
  grid.innerHTML = '';
  list.forEach((v)=>{
    const card = document.createElement('article');
    card.className = 'card';
    card.setAttribute('role','button');
    card.setAttribute('tabindex','0');
    const tmb = v.thumb || 'data:image/svg+xml,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'640\' height=\'360\'><rect width=\'100%\' height=\'100%\' fill=\'%230b0f14\'/></svg>';
    card.innerHTML = `
      <div class="thumb">
        <img loading="lazy" src="${tmb}" alt="Thumbnail ${escapeHtml(v.title||'')}">
        <span class="pill">${badge(v)}</span>
      </div>
      <div class="meta">
        <div class="title">${escapeHtml(v.title||'Tanpa judul')}</div>
        <div class="sub">Tap untuk memutar</div>
      </div>`;
    card.addEventListener('click', ()=> play(v));
    card.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); play(v); } });
    grid.appendChild(card);
  });
  countTxt.textContent = `${list.length} item`;
}

function badge(v){
  const t = detectType(v);
  return t.toUpperCase();
}

function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]));
}

// ====== Play Logic (MP4 / HLS / DASH / EMBED) ======
function clearEmbed(){
  const ifr = playerWrap.querySelector('iframe.embed');
  if(ifr) ifr.remove();
}

function destroyEngines(){
  if(hls){ hls.destroy(); hls=null; }
  if(dash){ dash.reset(); dash=null; }
}

function ensureVideoEl(){
  clearEmbed();
  if(!playerWrap.contains(player)){
    playerWrap.innerHTML = `<video id="player" controls playsinline preload="metadata" poster="" controlslist="nodownload noplaybackrate"><source id="playerSrc" src="" type="video/mp4" /></video>`;
  }
}

function play(v){
  const type = detectType(v);
  currentType = type;
  nowTitle.textContent = v.title || 'Memutar…';
  btnOpen.onclick = () => window.open(v.src, '_blank');

  destroyEngines();

  if(type==='embed'){
    // Swap to iframe
    const videoElOld = playerWrap.querySelector('video');
    if(videoElOld) { try{ videoElOld.pause(); }catch{} }
    clearEmbed();
    playerWrap.innerHTML = `<iframe class="embed" allowfullscreen referrerpolicy="no-referrer" src="${v.src}"></iframe>`;
    return;
  }

  // Use <video>
  ensureVideoEl();
  const videoEl = playerWrap.querySelector('video');

  if(type==='mp4'){
    videoEl.src = v.src;
    videoEl.poster = v.thumb || '';
    videoEl.load();
    videoEl.muted = true;
    videoEl.play().catch(()=>{});
    return;
  }

  if(type==='hls'){
    if(videoEl.canPlayType('application/vnd.apple.mpegurl')){
      videoEl.src = v.src; // Safari iOS native HLS
    }else if(window.Hls){
      hls = new Hls({maxBufferLength:20});
      hls.loadSource(v.src);
      hls.attachMedia(videoEl);
    }else{
      alert('HLS tidak didukung di browser ini.');
      return;
    }
    videoEl.poster = v.thumb || '';
    videoEl.play().catch(()=>{});
    return;
  }

  if(type==='dash'){
    if(window.dashjs){
      dash = dashjs.MediaPlayer().create();
      dash.initialize(videoEl, v.src, true);
    }else{
      alert('DASH tidak didukung di browser ini.');
      return;
    }
    videoEl.poster = v.thumb || '';
    return;
  }
}

function detectType(v){
  if(v.type){ return v.type; }
  const u = (v.src||'').toLowerCase();
  if(u.includes('youtube.com/embed')||u.includes('iframe')||u.startsWith('about:blank#embed')) return 'embed';
  if(u.endsWith('.m3u8')||u.includes('.m3u8?')) return 'hls';
  if(u.endsWith('.mpd')||u.includes('.mpd?')) return 'dash';
  if(u.endsWith('.mp4')||u.includes('.mp4?')) return 'mp4';
  // last resort: treat unknown as embed (many providers share via embed)
  return 'embed';
}

btnPip.addEventListener('click', async ()=>{
  if(currentType==='embed'){ return alert('PiP tidak tersedia untuk embed.'); }
  const videoEl = playerWrap.querySelector('video');
  if(!videoEl) return alert('Tidak ada video aktif.');
  if ('pictureInPictureEnabled' in document) {
    try{
      if (document.pictureInPictureElement) await document.exitPictureInPicture();
      else await videoEl.requestPictureInPicture();
    }catch(e){ alert('PiP tidak tersedia di perangkat ini.'); }
  } else alert('PiP tidak didukung di browser ini.');
});

// ====== Search ======
inputQ.addEventListener('input', ()=>{
  const q = inputQ.value.trim().toLowerCase();
  const filtered = listData.filter(v => (v.title||'').toLowerCase().includes(q));
  render(filtered);
});

// ====== Playlist Loader (.m3u / .json) ======
btnLoad.addEventListener('click', async ()=>{
  const url = playlistUrl.value.trim();
  if(!url) return alert('Masukkan URL playlist .m3u / .json');
  try{
    const res = await fetch(url);
    if(!res.ok) throw new Error('Gagal fetch');
    const text = await res.text();
    listData = parsePlaylist(text, url);
    render(listData);
    if(listData[0]) play(listData[0]);
  }catch(e){ alert('Tidak bisa memuat playlist. Pastikan CORS/URL benar.'); }
});

filePick.addEventListener('change', async ()=>{
  const f = filePick.files[0]; if(!f) return;
  const text = await f.text();
  listData = parsePlaylist(text, f.name);
  render(listData);
  if(listData[0]) play(listData[0]);
});

function parsePlaylist(raw, nameHint=''){
  const lower = nameHint.toLowerCase();
  // JSON array
  try{
    if(lower.endsWith('.json') || raw.trim().startsWith('[')){
      const arr = JSON.parse(raw);
      return (arr||[]).map(n=>({ title:n.title||n.name||'Tanpa judul', src:n.src||n.url||'', thumb:n.thumb||n.logo||n.image||'', type:n.type||undefined }));
    }
  }catch{ /* fallback to m3u */ }

  // M3U parser (#EXTM3U)
  const lines = raw.split(/
?
/);
  const out = [];
  let cur = {title:'', thumb:''};
  for(const line of lines){
    if(line.startsWith('#EXTINF')){
      const t = line.replace(/^#EXTINF:[^,]*,?/, '');
      // logo attribute if present: tvg-logo="URL"
      const logoMatch = line.match(/tvg-logo=\"([^\"]+)\"/i);
      cur = { title: (t||'').trim(), thumb: logoMatch? logoMatch[1]:'' };
    }else if(line.trim() && !line.startsWith('#')){
      out.push({ title: cur.title||'Tanpa judul', src: line.trim(), thumb: cur.thumb });
      cur = {title:'', thumb:''};
    }
  }
  return out.length? out: defaults.slice();
}

// ====== Boot ======
listData = defaults.slice();
render(listData);
// Tidak autoplay paksa; klik untuk play

</script>
</body>
</html>
